<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glimpse</title>
    <link rel="stylesheet" href="sidebar.css">
    <link rel="stylesheet" href="retry.css">
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- PDF.js for client-side PDF text extraction (used by Personalization) -->
    <script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
</head>
<body>
    <div class="chat-container">
        <header class="chat-header">
            <div class="header-content">
                <div class="ai-avatar" id="headerLogo" title="Start new session">
                    <img src="icon-48.png" alt="Glimpse logo" />
                </div>
                <div class="header-text">
                    <h1>Glimpse</h1>
                    <span class="status-indicator" id="statusIndicator">Ready</span>
                </div>
                <div class="header-buttons">
                    <button class="header-btn" id="helpBtn" title="Help & Tutorial">
                        <i data-lucide="help-circle" class="lucide"></i>
                    </button>
                    <button class="header-btn" id="historyBtn" title="Chat History">
                        <i data-lucide="history" class="lucide"></i>
                    </button>
                    <button class="header-btn" id="newSessionBtn" title="New Session">
                        <i data-lucide="plus" class="lucide"></i>
                    </button>
                    <button class="header-btn" id="settingsBtn" title="Settings">
                        <i data-lucide="settings" class="lucide"></i>
                    </button>
                    <span class="kbd-hint" title="Toggle sidebar (also Ctrl+Shift+Y)" aria-label="Keyboard shortcut F1">F1</span>
                </div>
            </div>
        </header>

        <div class="settings-panel" id="settingsPanel">
            <div class="settings-content">
                <div class="settings-header">
                    <h3>
                        <i data-lucide="settings" class="lucide"></i>
                        Settings
                    </h3>
                    <span class="settings-hint">Scroll to see all options</span>
                    <button class="close-settings-btn" id="closeSettingsBtn">
                        <i data-lucide="x" class="lucide"></i>
                    </button>
                </div>
                <div class="setting-group">
                    <label for="providerSelect">
                        <i data-lucide="globe" class="lucide"></i>
                        Provider
                    </label>
                    <select id="providerSelect">
                        <option value="google">Google Gemini</option>
                        <option value="openrouter">OpenRouter</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="apiKey">
                        <i data-lucide="key" class="lucide"></i>
                        <span id="apiKeyLabel">Gemini API Key</span>
                    </label>
                    <div class="input-wrapper" id="geminiKeyWrapper">
                        <input type="password" id="apiKey" placeholder="Enter your Gemini API key">
                        <button class="toggle-password" type="button">
                            <i data-lucide="eye" class="lucide"></i>
                        </button>
                    </div>
                    <div class="input-wrapper" id="openrouterKeyWrapper" style="display:none; margin-top:8px;">
                        <input type="password" id="openrouterApiKey" placeholder="Enter your OpenRouter API key">
                        <button class="toggle-password" type="button">
                            <i data-lucide="eye" class="lucide"></i>
                        </button>
                    </div>
                    <button id="saveSettings" class="primary-btn">
                        <i data-lucide="save" class="lucide"></i>
                        Save Settings
                    </button>
                </div>
                <div class="setting-group">
                    <label for="modelSelect">
                    <i data-lucide="cpu" class="lucide"></i>
                    Model Name
                </label>
                <input type="text" id="modelInput" placeholder="e.g. gemini-2.5-flash" autocomplete="off">
                </div>

                <!-- Auto-include Active Tab Content setting -->
                <div class="setting-group">
                    <label>
                        <i data-lucide="link" class="lucide"></i>
                        Auto-include active tab when sending.
                    </label>
                    <div class="checkbox-row">
                        <input type="checkbox" id="includeActiveTabCheckbox">
                        <label for="includeActiveTabCheckbox">Automatically include the active tab content</label>
                    </div>
                </div>

                <!-- Google Search grounding -->
                <div class="setting-group">
                    <label>
                        <i data-lucide="search" class="lucide"></i>
                        Enable Google Search grounding
                    </label>
                    <div class="checkbox-row">
                        <input type="checkbox" id="enableGoogleSearch">
                        <label for="enableGoogleSearch">Let Gemini use Google Search for real-time info and citations</label>
                    </div>
                    <div class="hint">Requires supported Gemini models; adds citations when available.</div>
                </div>

                <!-- Personalization (Profile) -->
                <div class="setting-group" id="personalizationGroup">
                    <label>
                        <i data-lucide="user" class="lucide"></i>
                        Personalization (Profile)
                    </label>
                    <div class="checkbox-row">
                        <input type="checkbox" id="includeProfileByDefault">
                        <label for="includeProfileByDefault">Include my profile in prompts by default</label>
                    </div>

                    <label for="profileText">
                        <i data-lucide="file-text" class="lucide"></i>
                        About me
                    </label>
                    <textarea id="profileText" placeholder="Add details about yourself, goals, preferences, writing style, do/don'ts..."></textarea>

                    <div class="profile-actions">
                        <input type="file" id="profileFileInput" accept=".txt,.md,.pdf" multiple style="display:none;">
                        <button id="addProfileFilesBtn" class="action-btn attach" type="button">
                            <i data-lucide="paperclip" class="lucide"></i>
                            Attach profile files (.txt, .md, .pdf)
                        </button>
                        <button id="summarizeProfileBtn" class="action-btn secondary" type="button" title="Generate a compact summary used in prompts">
                            <i data-lucide="wand-2" class="lucide"></i>
                            Generate summary
                        </button>
                        <button id="saveProfileBtn" class="primary-btn" type="button">
                            <i data-lucide="save" class="lucide"></i>
                            Save Profile
                        </button>
                    </div>

                    <div id="profileFilesList" class="profile-files-list"></div>

                    <label for="profileSummary">
                        <i data-lucide="sparkles" class="lucide"></i>
                        Profile summary (used in prompts)
                    </label>
                    <textarea id="profileSummary" placeholder="Summary will appear here (editable)" ></textarea>

                    <div class="checkbox-row" title="Overrides the default for the next message only">
                        <input type="checkbox" id="includeProfileNextMessage">
                        <label for="includeProfileNextMessage">Include profile for the next message only</label>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <div class="ai-avatar large">
                    <img src="icon-96.png" alt="Glimpse logo large" />
                </div>
                <h2>Welcome to Glimpse</h2>
                <p>I'm here to help you with any questions or tasks. Please configure your Gemini API key in settings to get started.</p>
                <div class="welcome-actions">
                    <button class="action-btn" id="configureSettingsBtn">
                        <i data-lucide="settings" class="lucide"></i>
                        Configure Settings
                    </button>
                </div>
                <!-- Quick Actions panel visible only on welcome/new sessions -->
                <div class="quick-actions" id="welcomeQuickActions">
                    <div class="quick-action" id="qaSummarize">
                        <div class="qa-icon"><i data-lucide="file-text" class="lucide"></i></div>
                        <div class="qa-text">
                            <div class="qa-title">Summarize page</div>
                            <div class="qa-desc">Creates a concise summary of the current page</div>
                        </div>
                    </div>
                    <div class="quick-action" id="qaExtract">
                        <div class="qa-icon"><i data-lucide="list-checks" class="lucide"></i></div>
                        <div class="qa-text">
                            <div class="qa-title">Extract action items</div>
                            <div class="qa-desc">Finds tasks with owners and deadlines</div>
                        </div>
                    </div>
                    <div class="quick-action" id="qaExplain">
                        <div class="qa-icon"><i data-lucide="image" class="lucide"></i></div>
                        <div class="qa-text">
                            <div class="qa-title">Explain a screenshot</div>
                            <div class="qa-desc">Describes what’s in an attached image</div>
                        </div>
                    </div>
                    <div class="quick-action" id="qaSelection">
                        <div class="qa-icon"><i data-lucide="mouse-pointer" class="lucide"></i></div>
                        <div class="qa-text">
                            <div class="qa-title">Use selected text</div>
                            <div class="qa-desc">Captures selected text from the page</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-input-container">
            <div class="file-preview" id="filePreview"></div>
            <div class="chat-input-wrapper">
                <input type="file" id="fileInput" accept="image/*,video/*,.txt,.md,.pdf,.doc,.docx" multiple style="display: none;">
                
                <div class="input-actions-left" id="toolbarActions">
                    <button id="captureTabButton" class="action-btn secondary" title="Capture current tab content (text)">
                        <i data-lucide="file-text" class="lucide"></i>
                    </button>
                    <button id="screenshotButton" class="action-btn screenshot" title="Take screenshot of current tab">
                        <i data-lucide="camera" class="lucide"></i>
                    </button>
                    <button id="youtubeAnalysisButton" class="action-btn youtube" title="Analyze YouTube video (transcript + visual)">
                        <i data-lucide="youtube" class="lucide"></i>
                    </button>
                    <button id="attachButton" class="action-btn attach" title="Attach files">
                        <i data-lucide="paperclip" class="lucide"></i>
                    </button>
                    <!-- Quick Actions moved to welcome only; toolbar shows only capture/attach -->
                </div>
                
                <div class="input-container">
                    <textarea id="messageInput" placeholder="Ask or type @ to attach open tabs (e.g. @amazon) — Ctrl+V to paste images" rows="1"></textarea>
                    <div class="input-actions-right">
                        <button id="sendButton" class="send-button" disabled>
                            <i data-lucide="send" class="lucide"></i>
                        </button>
                        <button id="stopButton" class="stop-button" style="display: none;">
                            <i data-lucide="square" class="lucide"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Panel -->
        <div class="history-panel" id="historyPanel">
                <div class="history-header">
                <div class="history-title">
                    <i data-lucide="history" class="lucide"></i>
                    <h3>Chat History</h3>
                </div>
                <button class="delete-all-btn" id="deleteAllHistoryBtn" title="Delete All History" style="margin-right:8px;">
                    <i data-lucide="trash-2" class="lucide"></i> Delete All
                </button>
                <button class="close-btn" id="closeHistoryBtn">
                    <i data-lucide="x" class="lucide"></i>
                </button>
            </div>
            <div class="history-content" id="historyContent">
                <div class="no-history">
                    <i data-lucide="message-square" class="lucide"></i>
                    <p>No chat history yet</p>
                    <span>Start a conversation to see your history here</span>
                </div>
            </div>
        </div>

        <!-- Help / Tutorial Modal (step-by-step) -->
        <div class="modal-overlay" id="helpModal" aria-hidden="true" role="dialog" aria-modal="true" style="display:none;">
            <div class="modal" role="document">
                <div class="modal-header">
                    <div class="modal-title">
                        <i data-lucide="help-circle" class="lucide"></i>
                        <h3>Using Glimpse</h3>
                    </div>
                    <button class="modal-close" id="helpCloseBtn" aria-label="Close">
                        <i data-lucide="x" class="lucide"></i>
                    </button>
                </div>
                <div class="modal-body" id="helpContent">
                    <div id="helpSteps">
                        <div class="help-step" data-step="1">
                            <div class="help-section">
                                <h4>1/6 · Getting started</h4>
                                <ul>
                                    <li>Choose provider and enter API key in Settings.</li>
                                    <li>Pick a model (e.g., <code>gemini-2.5-flash</code>).</li>
                                    <li>Type your question or attach context, then Send.</li>
                                </ul>
                                <div class="help-actions">
                                    <button class="primary-btn help-action" data-action="openSettings">
                                        <i data-lucide="settings" class="lucide"></i> Open Settings
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="help-step" data-step="2">
                            <div class="help-section">
                                <h4>2/6 · Quick capture</h4>
                                <div class="help-grid">
                                    <button class="help-btn help-action" data-action="captureTab" title="Capture current tab text">
                                        <i data-lucide="file-text" class="lucide"></i> Capture Page
                                    </button>
                                    <button class="help-btn help-action" data-action="screenshot" title="Take a screenshot">
                                        <i data-lucide="camera" class="lucide"></i> Screenshot
                                    </button>
                                    <button class="help-btn help-action" data-action="analyzeYouTube" title="Analyze YouTube (transcript + visual)">
                                        <i data-lucide="youtube" class="lucide"></i> YouTube Analysis
                                    </button>
                                    <button class="help-btn help-action" data-action="attachFiles" title="Attach files">
                                        <i data-lucide="paperclip" class="lucide"></i> Attach Files
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="help-step" data-step="3">
                            <div class="help-section">
                                <h4>3/6 · Context & personalization</h4>
                                <ul>
                                    <li>Use <strong>@</strong> to mention and attach open tabs.</li>
                                    <li>Turn on <strong>Auto-include current page URL</strong> in Settings.</li>
                                    <li>Add a profile to personalize answers; generate a summary.</li>
                                </ul>
                                <div class="help-actions">
                                    <button class="help-btn help-action" data-action="openProfile">
                                        <i data-lucide="user" class="lucide"></i> Personalization
                                    </button>
                                    <button class="help-btn help-action" data-action="prefillAtMentions">
                                        <i data-lucide="at-sign" class="lucide"></i> Try @mentions
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="help-step" data-step="4">
                            <div class="help-section">
                                <h4>4/6 · Google Search grounding</h4>
                                <p>Enable Search grounding to let Gemini consult the web and add citations.</p>
                                <div class="help-actions">
                                    <button class="help-btn help-action" data-action="toggleGrounding">
                                        <i data-lucide="search" class="lucide"></i> Toggle Grounding
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="help-step" data-step="5">
                            <div class="help-section">
                                <h4>5/6 · Sessions & history</h4>
                                <ul>
                                    <li>Click the logo to start a new session.</li>
                                    <li>Use History to revisit, pin, or delete chats.</li>
                                </ul>
                                <div class="help-actions">
                                    <button class="help-btn help-action" data-action="startNewSession">
                                        <i data-lucide="plus" class="lucide"></i> New Session
                                    </button>
                                    <button class="help-btn help-action" data-action="openHistory">
                                        <i data-lucide="history" class="lucide"></i> Open History
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="help-step" data-step="6">
                            <div class="help-section">
                                <h4>6/6 · Tips</h4>
                                <ul>
                                    <li>Use markdown in prompts; code blocks are copyable.</li>
                                    <li>Retry an AI answer via the Retry button under messages.</li>
                                    <li>Keyboard: Enter to send, Shift+Enter for newline.</li>
                                </ul>
                                <p class="help-contact">Need help or have feedback? Contact <a href="mailto:aziz@briskl.tech">aziz@briskl.tech</a></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="help-footer-left">
                        <div class="help-progress" id="helpProgress"></div>
                    </div>
                    <div class="help-footer-right">
                        <button class="action-btn secondary" id="helpSkipBtn" type="button">Skip</button>
                        <button class="action-btn secondary" id="helpPrevBtn" type="button">Back</button>
                        <button class="primary-btn" id="helpNextBtn" type="button">Next</button>
                        <button class="primary-btn" id="helpDoneBtn" type="button" style="display:none;">Done</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="sidebar.js"></script>
</body>
</html>
